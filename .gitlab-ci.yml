---
build:
    tags: [dev-utils]
    stage: build
    before_script:
        - cargo --version
    script:
        - cargo build --release
        - cp target/release/poppy .
    artifacts:
        paths:
            - ./poppy

install-dev:
    tags: [dev-utils]
    stage: install
    needs:
        - job: build
          artifacts: true
    script:
        - cp ./poppy /usr/bin/
        - poppy --version
    artifacts:
        paths: 
            - ./poppy

package:
    tags: [dev-utils]
    stage: package
    needs:
        - job: build
          artifacts: true
    script:
        - tar -czvf poppy.tar.gz poppy
    artifacts:
        paths:
            - ./poppy.tar.gz

push-artifactory:
    tags: [dev-utils]
    stage: push
    needs:
        - job: package
          artifacts: true
    script:
        - chmod +x ./poppup.py
        - ./poppup.py --push --file=./poppy.tar.gz --name=poppy --arch=linux-x64

stages:
    - build
    - install
    - package
    - push
    
